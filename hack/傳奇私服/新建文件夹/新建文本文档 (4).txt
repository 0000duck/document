

玩传奇最讨厌的就是走路，特别是那些洞，晕哦。
后来听说传奇里面有秘密入口，今天看了一下传奇的地图格式。其实很简单啊。
传奇地图是TILE方式的，总共分3层。

第一层是地表结构。就是地面贴图。
第二层好象是竖起来的东西。就是类似墙一样的东西。
第三层是一种障碍的东西好象。

他的地图开始就是两个USHORT的地图宽度和高度。
然后是在OFS=52开始是真正的地图信息。
好象是每个位置存放3个4字节的数据。
我们用一个结构来表示

struct t_mirmap
{
    DWORD layer[3];
};

t_mirmap map[w][h];

然后把数据读到map里面，就得到地图数据了。
可以OUT一下试试，因为都是DWORD的，可以当作位图来显示的。我想在传奇里面，他也是用处理BITMAP的方式来处理的吧。
不过我显示后发现，地图是反的，要把X，Y互相调换才能得到和游戏里面一样的地图形式。
不过出入口等事件触发的地方好象在第二层显示的，在位图上，房子出口的地方是兰色的。具体的我也没有搞明白，哪位朋友能帮一下忙。
这样，应该可以发现所有的暗门吧。我发现D7XX的地图都是石墓的地图。其他的不知道。
M什么的好象有个未知暗殿的图，而且我发现在未知中间有很多东西。右下还有类似楼梯的东西。不知道是什么，可能是什么极品屋之类的吧。















传奇2的Map文件，前面52个字节是文件头，前4个字节是两个Integer型的值，表示地图的高度和宽度。其余48个字节是文件标识之类，不用管。
之后，每12个字节表示地图上的一个坐标，在分析那12个字节之前，先说说Wil文件，
Objects? 地图数据(地面物件)
SmTiles 构造地面的基本物件(小)
Tiles 构造地面的基本物件(大) 文章来自：www.17577.org
Map文件里面其实就是对上面的文件的索引，从里面得到地图的图像数据。
好了，现在说那12个字节，
首先一个Integer型的，表示这一块是Tiles.Wil文件里的第几张图片。不过这个值的最高的一个二进制位是表示这个地方是不是允许玩家在上面走动的。
然后又一个Integer型的，索引的SmTiles.Wil
再一个Integer型的，是对Objects的索引，首位也是可移动标记。不过那种Objects文件不只一个，第11个字节的值就是表示是第几个Objects文件了。
第7和第8个字节是表示地图上有动画的，比如我们进商店里有些有开门的动画。
第9和10个字节我还没弄明白，不知道具体的作用。
第12个字节也不太清楚。
知道了上面那些，写个传奇2的地图查看程序，足够了。